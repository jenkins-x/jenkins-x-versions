buildPack: none
pipelineConfig:
  pipelines:
    release:
      pipeline:
        agent:
          image: gcr.io/jenkinsxio/builder-jx:0.1.639
        stages:
          - name: versions-release
            environment:
              - name: JX_VERSION
                value: $(sed "s:^.*$GH_OWNER\/$GH_REPO.*\[\([0-9.]*\)\].*$:\1:;t;d" /workspace/source/dependency-matrix/matrix.md)
            steps:
              - name: changelog
                command: jx
                args:
                - step
                - changelog
                - --verbose
                - --version
                - ${VERSION}
                - --rev
                - ${PULL_BASE_SHA}

              - name: release-jx
                command: ./jx/scripts/release-jx.sh

              - name: update-jx-bot
                image: gcr.io/jenkinsxio/builder-jx:0.1.639
                command: ./jx/scripts/update-jx-bot.sh

              - name: update-jx-website
                image: gcr.io/jenkinsxio/builder-go:0.1.639
                command: ./jx/scripts/update-jx-website.sh

              - name: update-jx-clients
                image: gcr.io/jenkinsxio/builder-maven:0.1.639
                command: ./jx/scripts/update-jx-clients.sh
